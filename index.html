<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Herramientas - Caja de Ahorro y Crédito Tupak Rantina</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- MathJax for formula rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Custom Styles and Tailwind Config -->
    <style>
        html {
            scrollbar-gutter: stable;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            margin: 0;
            padding: 0;
        }

        #loading-screen.fade-out {
            opacity: 0;
            visibility: hidden;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
        }

        .loading-brand {
            color: white;
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        /* Hide main content initially */
        #app {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #app.show {
            opacity: 1;
            visibility: visible;
        }

        /* Ensure MathJax formula is visible on dark backgrounds */
        .mathjax-formula {
            color: white;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: #e48410 #015cd0;
        }
        
        /* Modern scrollbar design */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #e48410 0%, #d97706 50%, #b45309 100%);
            border-radius: 8px;
            border: 2px solid #f8fafc;
            box-shadow: 0 2px 4px rgba(228, 132, 16, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #f59e0b 0%, #d97706 50%, #92400e 100%);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
            transform: scale(1.1);
        }
        
        ::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, #f97316 0%, #ea580c 50%, #c2410c 100%);
            box-shadow: 0 6px 12px rgba(249, 115, 22, 0.5);
        }
        
        ::-webkit-scrollbar-corner {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 0 0 8px 0;
        }
        
        /* Firefox modern scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: #e48410 #f8fafc;
        }
        
        /* Enhanced scrollbar for mobile */
        @media (max-width: 640px) {
            ::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            ::-webkit-scrollbar-thumb {
                border: 1px solid #f8fafc;
            }
            * {
                scrollbar-width: thin;
            }
        }
        
        /* Custom scrollbar for tables */
        .scroll-container {
            scrollbar-width: thin;
            scrollbar-color: #e48410 #f1f5f9;
        }
        
        .scroll-container::-webkit-scrollbar {
            height: 6px;
            width: 6px;
        }
        
        .scroll-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        .scroll-container::-webkit-scrollbar-thumb {
            background: #e48410;
            border-radius: 10px;
        }
        
        .scroll-container::-webkit-scrollbar-thumb:hover {
            background: #d97706;
        }
        
        /* Tab styles */
        .tab-container {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }
        .tab-button {
            padding: 8px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab-button.active {
            color: #001749;
            border-bottom-color: #001749;
        }
        .tab-button:hover {
            color: #001749;
        }
        
        /* Estilos para menú móvil */
        .mobile-tab-button {
            color: #374151;
            font-weight: 500;
            transition: all 0.2s;
        }
        .mobile-tab-button:hover {
            color: #001749;
            background-color: #f9fafb;
        }
        .mobile-tab-button.active {
            color: #001749;
            background-color: #eff6ff;
        }
        
        .tab-content {
            display: none;
            flex: 1;
            overflow: auto;
            min-height: 70vh;
            transition: opacity 0.3s ease-in-out;
        }
        .tab-content.active {
            display: flex;
            flex-direction: column;
            opacity: 1;
        }
        .iframe-container {
            width: 100%;
            flex: 1;
            border: none;
        }
        
        /* Toast notifications */
        .toast {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Modal styles */
        #confirmation-modal {
            display: none;
        }
        
        #confirmation-modal.show {
            display: flex;
        }
        
        /* Login form styles */
        #login-container {
            display: none;
        }
        
        #login-container.show {
            display: flex;
        }
        
        /* Checklist styles */
        .document-checkbox {
            accent-color: #ff8c42;
        }
        
        .document-checkbox:checked {
            background-color: #ff8c42;
            border-color: #ff8c42;
        }
        
        .document-checkbox:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 140, 66, 0.5);
        }
        
        /* Smooth transitions for row styling */
        .p-4 {
            transition: background-color 0.2s ease;
        }
        
        /* Custom checkbox styling for better visibility */
        .document-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 0.25rem;
            border: 2px solid #d1d5db;
            appearance: none;
            background-color: white;
            cursor: pointer;
            position: relative;
        }
        
        .document-checkbox:checked::before {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.875rem;
            font-weight: bold;
        }
        
        /* Responsive adjustments for mobile */
        @media (max-width: 640px) {
            .document-checkbox {
                width: 1.125rem;
                height: 1.125rem;
            }
            
            .document-checkbox:checked::before {
                font-size: 0.75rem;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark-blue': '#001749',
                        'brand-orange': '#e48410',
                        'brand-light-blue': '#3787c6',
                        'brand-accent-blue': '#015cd0',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 antialiased">

    <!-- Loading Screen -->
    <div id="loading-screen" style="display: flex;">
        <div class="text-center">
            <div class="loading-spinner"></div>
            <div class="loading-text">Verificando sesión...</div>
            <div class="loading-brand">Centro de Herramientas</div>
        </div>
    </div>

    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-brand-dark-blue text-white py-6 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4 ml-[5%] transition-all duration-300 ease-in-out">
                        <img src="https://i.postimg.cc/zBPmbxNT/TRANSPARENTE-min.png" 
                             alt="Centro de Servicios Públicos Logo" 
                             class="h-12 md:h-16 w-auto transition-all duration-300 ease-in-out">
                        <div class="text-left">
                            <h1 class="text-xl md:text-2xl font-bold transition-all duration-300 ease-in-out">Centro de Herramientas</h1>
                            <p class="text-gray-300 text-xs md:text-sm transition-all duration-300 ease-in-out">Caja de Ahorro y Crédito Tupak Rantina</p>
                        </div>
                    </div>
                    
                    <!-- User Info and Logout -->
                    <div class="flex items-center space-x-4">
                        <div class="text-right hidden md:block">
                            <div class="text-sm text-gray-300">Bienvenido</div>
                            <div id="user-info" class="font-semibold">Usuario</div>
                        </div>
                        <div id="logout-btn" class="hidden">
                            <!-- Logout button will be added by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-container bg-white">
            <!-- Botón hamburguesa a la izquierda y título único (solo móvil) -->
            <div class="md:hidden flex items-center p-4 relative" style="min-height:48px;">
                <button id="mobile-menu-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors" style="position:relative; left:10px; z-index:20;">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <span class="font-semibold text-gray-800 ml-4 truncate w-full text-center" id="current-tab-title" style="margin-left:44px;">Calculadora</span>
            </div>
            
            <!-- Menú móvil (oculto por defecto) - Sin Imprimibles -->
            <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-200 absolute left-0 top-0 mt-12 w-full z-50 shadow-lg" style="min-width:200px;">
                <button class="mobile-tab-button w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100" onclick="switchTab(0, 'Calculadora', true)">
                    <i class="fas fa-calculator mr-3 text-blue-600"></i>Calculadora
                </button>
                <button class="mobile-tab-button w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100" onclick="switchTab(1, 'Herramientas de Consulta', true)">
                    <i class="fas fa-search mr-3 text-green-600"></i>Herramientas de Consulta
                </button>
                <button class="mobile-tab-button w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100" onclick="switchTab(2, 'Documentación', true)">
                    <i class="fas fa-book mr-3 text-purple-600"></i>Documentación
                </button>
                <button class="mobile-tab-button w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100" onclick="switchTab(3, 'Imprimibles', true)">
                    <i class="fas fa-print mr-3 text-red-600"></i>Imprimibles
                </button>
                <button class="mobile-tab-button w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors" onclick="switchTab(4, 'Autorización Exterior', true)">
                    <i class="fas fa-user-check mr-3 text-orange-600"></i>Autorización Exterior
                </button>
            </div>
            
            <!-- Pestañas desktop (ocultas en móvil) -->
            <div class="hidden md:flex">
                <button class="tab-button active" onclick="switchTab(0, 'Calculadora')">Calculadora</button>
                <button class="tab-button" onclick="switchTab(1, 'Herramientas de Consulta')">Herramientas de Consulta</button>
                <button class="tab-button" onclick="switchTab(2, 'Documentación')">Documentación</button>
                <button class="tab-button" onclick="switchTab(3, 'Imprimibles')">Imprimibles</button>
                <button class="tab-button" onclick="switchTab(4, 'Autorización Exterior')">Autorización Exterior</button>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="tab0" class="tab-content active">
        <!-- Main Content -->
        <main class="flex-grow py-6 px-4 bg-gray-50">
            <div class="max-w-7xl mx-auto">
                
                <!-- Calculator Section -->
                <div class="bg-white rounded-lg shadow-xl overflow-hidden mb-8">
                    <div class="lg:flex">
                        <!-- Left Side: Information -->
                        <div class="lg:w-1/3 p-6 bg-brand-accent-blue text-white">
                            <h2 class="text-2xl font-bold mb-4">Calculadora Financiera</h2>
                            <p class="text-gray-200 mb-4 text-sm">
                                Configure el tipo de financiamiento y calcule el monto total, tabla de amortización y costos.
                            </p>
                            
                            <!-- Formula Display -->
                            <div class="bg-white/20 p-3 rounded-lg mb-4">
                                <p class="font-semibold text-xs mb-2">Fórmulas Aplicadas:</p>
                                <div class="mathjax-formula text-xs">
                                    $$ \text{Cuota} = \frac{P \times r \times (1+r)^n}{(1+r)^n - 1} $$
                                </div>
                                <div class="mathjax-formula text-xs">
                                    $$ \text{Financ.} = \frac{\text{Neto}}{1 - \frac{\%Desc.}{100}} $$
                                </div>
                            </div>
                            
                            <div class="text-xs text-gray-200">
                                <p><strong>P:</strong> Capital | <strong>r:</strong> Tasa mensual | <strong>n:</strong> Períodos</p>
                            </div>
                        </div>

                        <!-- Right Side: Calculator Form -->
                        <div class="lg:w-2/3 p-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                
                                <!-- Column 1: Basic Data -->
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-brand-dark-blue border-b border-gray-200 pb-2">Datos Básicos</h3>
                                    
                                    <!-- Net Amount -->
                                    <div>
                                        <label for="netAmount" class="block text-sm font-medium text-gray-700">Monto Neto Requerido ($)</label>
                                        <input type="number" id="netAmount" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-accent-blue focus:ring-brand-accent-blue" placeholder="2500.00" value="2500">
                                    </div>

                                    <!-- Annual Interest Rate -->
                                    <div>
                                        <label for="annualRate" class="block text-sm font-medium text-gray-700">Tasa Anual (%)</label>
                                        <input type="number" id="annualRate" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-accent-blue focus:ring-brand-accent-blue" placeholder="26.00" value="26">
                                    </div>

                                    <!-- Term in months -->
                                    <div>
                                        <label for="termMonths" class="block text-sm font-medium text-gray-700">Plazo (meses)</label>
                                        <input type="number" id="termMonths" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-accent-blue focus:ring-brand-accent-blue" placeholder="12" value="12">
                                    </div>

                                    <!-- SOLCA Percentage -->
                                    <div>
                                        <label for="solcaPercentage" class="block text-sm font-medium text-gray-700">SOLCA (%)</label>
                                        <input type="number" id="solcaPercentage" step="0.001" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-accent-blue focus:ring-brand-accent-blue" placeholder="0.5" value="0.5">
                                    </div>

                                    <!-- Autoseguro Percentage -->
                                    <div>
                                        <label for="autoseguroPercentage" class="block text-sm font-medium text-gray-700">Autoseguro (%)</label>
                                        <input type="number" id="autoseguroPercentage" step="0.001" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-accent-blue focus:ring-brand-accent-blue" placeholder="0.72" value="0.72">
                                    </div>
                                </div>

                                <!-- Column 2: Patrimonial Contribution Options -->
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-brand-dark-blue border-b border-gray-200 pb-2">Aporte Patrimonial</h3>
                                    
                                    <!-- Patrimonial Contribution Percentage -->
                                    <div>
                                        <label for="patrimonialPercentage" class="block text-sm font-medium text-gray-700">Porcentaje Aporte (%)</label>
                                        <input type="number" id="patrimonialPercentage" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-accent-blue focus:ring-brand-accent-blue" placeholder="3.0" value="3">
                                    </div>

                                    <!-- Financing Option -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Financiamiento</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="radio" name="financingType" value="discount" class="text-brand-accent-blue focus:ring-brand-accent-blue" checked>
                                                <span class="ml-2 text-sm">Descontar del crédito</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" name="financingType" value="finance" class="text-brand-accent-blue focus:ring-brand-accent-blue">
                                                <span class="ml-2 text-sm">Financiar aporte</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Generate Button -->
                                    <button id="generateBtn" class="w-full bg-brand-orange hover:bg-orange-600 text-white font-semibold py-3 px-4 rounded-md transition duration-200 mt-4">
                                        Generar Cálculos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="grid lg:grid-cols-2 gap-8" style="display: none;">
                    
                    <!-- Summary Card -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-brand-dark-blue mb-4">Resumen del Crédito</h3>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">Monto Neto Solicitado:</span>
                                <span id="summaryNetAmount" class="font-semibold">$0.00</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">Aporte Patrimonial:</span>
                                <span id="summaryPatrimonialAmount" class="font-semibold">$0.00</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">Monto Total del Crédito:</span>
                                <span id="summaryTotalCredit" class="font-semibold text-brand-orange text-lg">$0.00</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">Desembolso Neto:</span>
                                <span id="summaryNetDisbursement" class="font-semibold text-green-600 text-lg">$0.00</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">Cuota Mensual Base:</span>
                                <span id="summaryBasePayment" class="font-semibold">$0.00</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">SOLCA:</span>
                                <span id="summarySolcaAmount" class="font-semibold text-gray-600">$0.00</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">Autoseguro:</span>
                                <span id="summaryAutoseguroAmount" class="font-semibold text-gray-600">$0.00</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                <span class="text-gray-600">Cuota Total:</span>
                                <span id="summaryMonthlyPayment" class="font-semibold text-blue-600 text-lg">$0.00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total a Pagar:</span>
                                <span id="summaryTotalToPay" class="font-semibold">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Info Card -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-brand-dark-blue mb-4">Información Adicional</h3>
                        
                        <div class="space-y-3">
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <p class="text-sm text-blue-800">
                                    <strong>Tipo de Financiamiento:</strong> 
                                    <span id="financingTypeDisplay">Descuento del crédito</span>
                                </p>
                            </div>
                            
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Tasa Mensual:</span>
                                    <span id="monthlyRateDisplay" class="font-medium">0.00%</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Total SOLCA:</span>
                                    <span id="totalSolcaDisplay" class="font-medium">$0.00</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Total Autoseguro:</span>
                                    <span id="totalAutoseguroDisplay" class="font-medium">$0.00</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Total Intereses:</span>
                                    <span id="totalInterestDisplay" class="font-medium">$0.00</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Plazo:</span>
                                    <span id="termDisplay" class="font-medium">0 meses</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Amortization Table -->
                <div id="amortizationSection" class="mt-8 bg-white rounded-lg shadow-lg p-6" style="display: none;">
                    <h3 class="text-xl font-bold text-brand-dark-blue mb-4">Tabla de Amortización</h3>
                    
                    <div class="overflow-x-auto scroll-container">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cuota</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Saldo Inicial</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cuota Base</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Interés</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Capital</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SOLCA</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Autoseguro</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cuota Total</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Saldo Final</th>
                                </tr>
                            </thead>
                            <tbody id="amortizationTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Table rows will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
        </div>

        <div id="tab1" class="tab-content">
            <div class="flex flex-col h-full bg-gray-50">
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-brand-dark-blue mb-6">Herramientas de Consulta</h2>
                    <!-- Gallery Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">

                                            
                        <!-- Consulta Ecuador Card -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer group max-w-sm mx-auto w-full" 
                             onclick="window.open('https://consultasecuador.com/en-linea/personas/consultar-nombres-con-cedula', '_blank')">
                            <div class="aspect-video bg-gray-200 relative overflow-hidden">
                                <img src="https://lh3.googleusercontent.com/d/1L48JHcPA9E3vPA2pgpv-sjnU36wVClE-=w2048?name=Screenshot%202025-09-10%20165918.png" 
                                     alt="Verificar Nombres con Cédula" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-brand-dark-blue mb-2">Verificar Nombres con Cédula</h3>
                                <p class="text-gray-600 text-xs md:text-sm mb-3 line-clamp-2">
                                    Consulta y verifica nombres asociados a números de cédula en Ecuador.
                                </p>
                                <div class="flex items-center text-brand-accent-blue text-xs md:text-sm font-medium">
                                    <span>Acceder al sistema</span>
                                    <svg class="w-3 h-3 md:w-4 md:h-4 ml-1 md:ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Autorización Buró de Crédito Card -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer group max-w-sm mx-auto w-full" 
                             onclick="window.open('autorizacion.html', '_blank')">
                            <div class="aspect-video bg-gray-200 relative overflow-hidden">
                                <img src="https://lh3.googleusercontent.com/d/1Ad540QfeZwub_InNyxbb0v3m0lrWfcAy=w2048?name=Screenshot%202025-09-14%20114903.png" 
                                     alt="Autorización de revisión del buró crediticio" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-brand-dark-blue mb-2">Autorización de revisión del buró crediticio</h3>
                                <p class="text-gray-600 text-xs md:text-sm mb-3 line-clamp-2">
                                    Genera una autorización formal para la consulta de tu historial crediticio.
                                </p>
                                <div class="flex items-center text-brand-accent-blue text-xs md:text-sm font-medium">
                                    <span>Generar documento</span>
                                    <svg class="w-3 h-3 md:w-4 md:h-4 ml-1 md:ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Equifax Card -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer group max-w-sm mx-auto w-full" 
                             onclick="window.open('https://www.equifax.com.ec/sso-web/', '_blank')">
                            <div class="aspect-video bg-gray-200 relative overflow-hidden">
                                <img src="https://lh3.googleusercontent.com/d/1fVSs_tfen9B9XtDa1NzZErbUfNkgRXlw=w2048?name=Screenshot%202025-09-10%20165545.png" 
                                     alt="Equifax Buró de Crédito" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-brand-dark-blue mb-2">Equifax Buró de Crédito</h3>
                                <p class="text-gray-600 text-xs md:text-sm mb-3 line-clamp-2">
                                    Consulta tu historial crediticio y reportes de crédito con Equifax Ecuador.
                                </p>
                                <div class="flex items-center text-brand-accent-blue text-xs md:text-sm font-medium">
                                    <span>Acceder al sistema</span>
                                    <svg class="w-3 h-3 md:w-4 md:h-4 ml-1 md:ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Consulta Judicial Card -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer group max-w-sm mx-auto w-full" 
                             onclick="window.open('https://procesosjudiciales.funcionjudicial.gob.ec/busqueda-filtros', '_blank')">
                            <div class="aspect-video bg-gray-200 relative overflow-hidden">
                                <img src="https://lh3.googleusercontent.com/d/1DlLnxlxRWev6PnrTABPpUgZKa1u-Jq-h=w2048?name=Screenshot%202025-09-10%20164635.png" 
                                     alt="Consulta de Procesos Judiciales" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-brand-dark-blue mb-2">Consulta de Procesos Judiciales</h3>
                                <p class="text-gray-600 text-xs md:text-sm mb-3 line-clamp-2">
                                    Accede al sistema de consulta de procesos judiciales de la Función Judicial del Ecuador.
                                </p>
                                <div class="flex items-center text-brand-accent-blue text-xs md:text-sm font-medium">
                                    <span>Acceder al sistema</span>
                                    <svg class="w-3 h-3 md:w-4 md:h-4 ml-1 md:ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SUPA Card -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer group max-w-sm mx-auto w-full" 
                             onclick="window.open('https://supa.funcionjudicial.gob.ec/pensiones/publico/consulta.jsf', '_blank')">
                            <div class="aspect-video bg-gray-200 relative overflow-hidden">
                                <img src="https://lh3.googleusercontent.com/d/18KYmHmmyL3jC86EdCVOcIersc0WuQqhO=w2048?name=Screenshot%202025-09-10%20165148.png" 
                                     alt="Sistema Único de Pensiones Alimenticias - SUPA" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-brand-dark-blue mb-2">SUPA</h3>
                                <p class="text-gray-600 text-xs md:text-sm mb-3 line-clamp-2">
                                    Sistema Único de Pensiones Alimenticias - Consulta de pensiones alimenticias.
                                </p>
                                <div class="flex items-center text-brand-accent-blue text-xs md:text-sm font-medium">
                                    <span>Acceder al sistema</span>
                                    <svg class="w-3 h-3 md:w-4 md:h-4 ml-1 md:ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SRI RUC Card -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer group max-w-sm mx-auto w-full" 
                             onclick="window.open('https://srienlinea.sri.gob.ec/sri-en-linea/SriRucWeb/ConsultaRuc/Consultas/consultaRuc', '_blank')">
                            <div class="aspect-video bg-gray-200 relative overflow-hidden">
                                <img src="https://lh3.googleusercontent.com/d/1QMiZTDTbqoJZT-IjXWDELXGojLWBlotl=w2048?name=Screenshot%202025-09-10%20174559.png" 
                                     alt="Consulta RUC - SRI" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-brand-dark-blue mb-2">Consulta RUC - SRI</h3>
                                <p class="text-gray-600 text-xs md:text-sm mb-3 line-clamp-2">
                                    Consulta información de RUC y datos tributarios con el Servicio de Rentas Internas.
                                </p>
                                <div class="flex items-center text-brand-accent-blue text-xs md:text-sm font-medium">
                                    <span>Acceder al sistema</span>
                                    <svg class="w-3 h-3 md:w-4 md:h-4 ml-1 md:ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ANT Multas Card -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer group max-w-sm mx-auto w-full" 
                             onclick="window.open('https://ant.com.ec/multas-transito', '_blank')">
                            <div class="aspect-video bg-gray-200 relative overflow-hidden">
                                <img src="https://lh3.googleusercontent.com/d/165EU5e_h4u_FaZ1DNQb3r4X5_pqfZnyi=w2048?name=Screenshot%202025-09-10%20174152.png" 
                                     alt="Multas de Tránsito ANT" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-brand-dark-blue mb-2">Multas de Tránsito</h3>
                                <p class="text-gray-600 text-xs md:text-sm mb-3 line-clamp-2">
                                    Consulta y verifica multas de tránsito con la Agencia Nacional de Tránsito (ANT).
                                </p>
                                <div class="flex items-center text-brand-accent-blue text-xs md:text-sm font-medium">
                                    <span>Acceder al sistema</span>
                                    <svg class="w-3 h-3 md:w-4 md:h-4 ml-1 md:ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden opacity-50 max-w-sm mx-auto w-full">
                            <div class="aspect-video bg-gray-200 flex items-center justify-center">
                                <div class="text-center text-gray-400">
                                    <svg class="w-8 h-8 md:w-12 md:h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    <p class="text-xs md:text-sm">Próximamente</p>
                                </div>
                            </div>
                            <div class="p-3 md:p-4">
                                <h3 class="text-base md:text-lg font-semibold text-gray-400 mb-2">Nueva Herramienta</h3>
                                <p class="text-gray-400 text-xs md:text-sm">
                                    Espacio reservado para futuras herramientas de consulta.
                                </p>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <div id="tab2" class="tab-content">
            <div class="flex flex-col h-full bg-gray-50">
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-brand-dark-blue mb-6">
                        <i class="fas fa-file-alt mr-2"></i>
                        Documentación para Créditos Aprobados
                    </h2>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div class="bg-blue-50 border-l-4 border-brand-accent-blue p-4 mb-6">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-info-circle text-brand-accent-blue"></i>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-blue-800">
                                        Guía para Asesores - Documentación de Créditos
                                    </h3>
                                    <div class="mt-2 text-sm text-blue-700">
                                        <p><strong>IMPORTANTE:</strong> Todos los documentos deben ser enviados en <strong>UN SOLO ARCHIVO PDF CONSOLIDADO</strong>, escaneados en el mismo orden que se indica a continuación:</p>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="space-y-4">
                            <!-- Recordatorio de Formalidad Institucional -->
                            <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-university text-blue-500"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-medium text-blue-800">
                                            Presentación Profesional de Documentos
                                        </h3>
                                        <div class="mt-2 text-sm text-blue-700">
                                            <p class="mb-2">
                                                <strong>Tupak Rantina</strong> es una institución financiera formal que mantiene altos estándares de calidad. 
                                                La documentación debe presentarse con la debida altura y exigencia profesional:
                                            </p>
                                            <ul class="list-disc list-inside space-y-1">
                                                <li><strong>Orientación adecuada:</strong> Todas las páginas deben estar correctamente orientadas (verticales las verticales, horizontales las horizontales)</li>
                                                <li><strong>Sin interferencias de visión:</strong> Documentos completamente visibles, sin sombras, reflejos o partes cortadas</li>
                                                <li><strong>Calidad profesional:</strong> Escaneos nítidos, bien iluminados y con buena resolución</li>
                                                <li><strong>Orden y presentación:</strong> Documentos organizados secuencialmente según esta guía</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Control de Checklist -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 mb-6">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                                <div class="flex items-center text-sm text-gray-600">
                                    <span id="checklistStatus">Checklist se reinicia automáticamente cada 7 días</span>
                                </div>
                                <button id="resetChecklistBtn" class="bg-brand-orange hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
                                    <i class="fas fa-refresh mr-2"></i>
                                    Reiniciar Checklist
                                </button>
                            </div>
                        </div>

                            <!-- Lista de documentos requeridos -->
                            <div class="border border-gray-200 rounded-lg overflow-hidden">
                                <div class="bg-gray-50 px-4 py-3 flex items-center justify-between">
                                    <h3 class="text-lg font-semibold text-brand-dark-blue">Documentos Requeridos (en orden)</h3>
                                    <div class="text-sm text-gray-600">
                                        <span id="completedCount">0</span> de <span id="totalCount">14</span> completados
                                    </div>
                                </div>
                                <div class="divide-y divide-gray-200">
                                    
                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc1" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="1">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">1</span>
                                            <div class="flex-1">
                                                <label for="doc1" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Copia de Cédula</h4>
                                                    <p class="text-sm text-gray-600">(Opcional: Papeleta de votación)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc2" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="2">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">2</span>
                                            <div class="flex-1">
                                                <label for="doc2" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Autorización de Revisión de Buró</h4>
                                                    <p class="text-sm text-gray-600">Documento firmado por el solicitante</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc3" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="3">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">3</span>
                                            <div class="flex-1">
                                                <label for="doc3" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Buró</h4>
                                                    <p class="text-sm text-gray-600">Reporte de historial crediticio</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc4" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="4">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">4</span>
                                            <div class="flex-1">
                                                <label for="doc4" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Revisión de Demandas Judiciales</h4>
                                                    <p class="text-sm text-gray-600">Consulta de procesos judiciales activos</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc5" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="5">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">5</span>
                                            <div class="flex-1">
                                                <label for="doc5" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Revisión de SUPA</h4>
                                                    <p class="text-sm text-gray-600">Sistema Único de Pensiones Alimenticias</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc6" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="6">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">6</span>
                                            <div class="flex-1">
                                                <label for="doc6" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Informe de Ingresos y Egresos</h4>
                                                    <p class="text-sm text-gray-600">Detalle financiero del solicitante</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc7" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="7">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">7</span>
                                            <div class="flex-1">
                                                <label for="doc7" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Hoja de Costos</h4>
                                                    <p class="text-sm text-gray-600">Cálculo de costos de producción (opcional)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc8" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="8">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">8</span>
                                            <div class="flex-1">
                                                <label for="doc8" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Facturas de Compra/Venta</h4>
                                                    <p class="text-sm text-gray-600 italic">(Si aplica - para actividades comerciales)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc9" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="9">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">9</span>
                                            <div class="flex-1">
                                                <label for="doc9" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Carnet de Sustento de Actividad</h4>
                                                    <p class="text-sm text-gray-600">Ejemplos para Mejía y Cotopaxi:</p>
                                                    <ul class="text-sm text-gray-600 mt-2 ml-4 list-disc">
                                                        <li>CONEFA (Consorcio de Empresas Florícolas)</li>
                                                        <li>Certificado de la Asociación de Ganaderos de Cotopaxi</li>
                                                        <li>Registro de la Cámara de Agricultura de Cotopaxi</li>
                                                        <li>Certificado de MAGAP (Ministerio de Agricultura)</li>
                                                        <li>Registro en la Asociación de Productores Agrícolas de Mejía</li>
                                                        <li>Carnet de la Federación de Ganaderos del Ecuador (FEDEGAN)</li>
                                                        <li>Certificado de la Unión de Organizaciones Campesinas de Cotopaxi</li>
                                                    </ul>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc10" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="10">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">10</span>
                                            <div class="flex-1">
                                                <label for="doc10" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Certificado de Trabajo</h4>
                                                    <p class="text-sm text-gray-600 italic">(Si aplica - para empleados en relación de dependencia)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc11" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="11">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">11</span>
                                            <div class="flex-1">
                                                <label for="doc11" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Referencias Comerciales</h4>
                                                    <p class="text-sm text-gray-600">(Opcional - cartas de proveedores o clientes)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc12" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="12">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">12</span>
                                            <div class="flex-1">
                                                <label for="doc12" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Matrícula de Vehículo</h4>
                                                    <p class="text-sm text-gray-600 italic">(Si aplica - para créditos vehiculares o como garantía)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc13" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="13">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">13</span>
                                            <div class="flex-1">
                                                <label for="doc13" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Impuesto Predial</h4>
                                                    <p class="text-sm text-gray-600 italic">(Si aplica - para propietarios de bienes inmuebles)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-4 hover:bg-gray-50 transition-colors">
                                        <div class="flex items-start">
                                            <div class="flex items-center mr-3">
                                                <input type="checkbox" id="doc14" class="document-checkbox w-5 h-5 text-brand-orange focus:ring-brand-orange border-gray-300 rounded" data-doc="14">
                                            </div>
                                            <span class="flex-shrink-0 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center text-sm font-bold mr-4">14</span>
                                            <div class="flex-1">
                                                <label for="doc14" class="cursor-pointer">
                                                    <h4 class="font-semibold text-gray-900">Cartilla de Servicios Básicos</h4>
                                                    <p class="text-sm text-gray-600">Planilla de luz o agua (últimos 3 meses)</p>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- Notas importantes -->
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-6">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-medium text-yellow-800">
                                            Notas Importantes
                                        </h3>
                                        <div class="mt-2 text-sm text-yellow-700">
                                            <ul class="list-disc list-inside space-y-1">
                                                <li><strong>UN SOLO ARCHIVO PDF CONSOLIDADO</strong> con todos los documentos en orden</li>
                                                <li>La calidad de escaneo debe permitir la lectura clara del contenido</li>
                                                <li>Respetar el orden establecido para agilizar el proceso de revisión</li>
                                                <li>Los documentos marcados como "Si aplica" solo se incluyen cuando corresponda al caso específico</li>
                                                <li>Para actividades agropecuarias en Mejía y Cotopaxi, verificar el tipo de carnet o certificado más apropiado</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    <div id="tab3" class="tab-content hidden">
            <div class="flex flex-col h-full bg-gray-50">
                <div class="p-6">
                    <iframe src="acta-credito.html" width="100%" height="800" frameborder="0"></iframe>
                </div>
            </div>
        </div>

        <div id="tab5" class="tab-content hidden">
            <div class="flex flex-col h-full bg-gray-50">
                <div class="p-6">
                    <iframe src="authform.html" width="100%" height="800" frameborder="0"></iframe>
                </div>
            </div>
        </div>

        <div id="customAlertModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all">
                <div class="p-6">
                    <div class="flex items-center mb-4">
                        <div class="flex-shrink-0">
                            <i id="alertIcon" class="fas fa-exclamation-triangle text-yellow-500 text-2xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 id="alertTitle" class="text-lg font-semibold text-gray-900">Confirmar Acción</h3>
                        </div>
                    </div>
                    <div class="mb-6">
                        <p id="alertMessage" class="text-sm text-gray-600">¿Estás seguro que deseas continuar?</p>
                    </div>
                    <div class="flex flex-col-reverse sm:flex-row sm:justify-end gap-3">
                        <button id="alertCancelBtn" class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button id="alertConfirmBtn" class="w-full sm:w-auto px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors">
                            Confirmar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-brand-dark-blue text-white py-4 px-6">
            <div class="max-w-7xl mx-auto text-center">
                <p class="text-sm text-gray-300">© 2025 Caja de Ahorro y Crédito Tupak Rantina</p>
            </div>
        </footer>
    </div>

    <script>
        // Tab switching function
        function switchTab(tabIndex, tabTitle = null) {
            // En móvil, evitar acceso a pestaña de Imprimibles
            if (window.innerWidth < 768 && tabIndex === 3) {
                return;
            }
            
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            const mobileButtons = document.querySelectorAll('.mobile-tab-button');
            const currentTabTitle = document.getElementById('current-tab-title');
            const mobileMenu = document.getElementById('mobile-menu');
            
            // Cambiar contenido de las pestañas
            tabs.forEach((tab, index) => {
                if (index === tabIndex) {
                    tab.classList.add('active');
                    tab.classList.remove('hidden');
                    if (window.innerWidth < 768) {
                        tab.classList.add('flex');
                    } else {
                        tab.classList.remove('flex');
                    }
                } else {
                    tab.classList.remove('active');
                    tab.classList.add('hidden');
                    tab.classList.remove('flex');
                }
            });
            
            // Actualizar botones de desktop
            buttons.forEach((button, index) => {
                if (index === tabIndex) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Actualizar botones de móvil
            mobileButtons.forEach((button, index) => {
                if (index === tabIndex) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Actualizar título en móvil y cerrar menú
            if (currentTabTitle) {
                // Definir títulos según el índice
                const titles = ['Calculadora', 'Herramientas de Consulta', 'Documentación', 'Imprimibles', 'Autorización Exterior'];
                currentTabTitle.textContent = tabTitle || titles[tabIndex];
            }
            // Siempre cerrar menú móvil al seleccionar una opción
            if (window.innerWidth < 768 && mobileMenu) {
                mobileMenu.classList.add('hidden');
            }
        }

        // Funcionalidad del menú hamburguesa
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    mobileMenu.classList.toggle('hidden');
                });
                // Cerrar menú al hacer clic fuera
                document.addEventListener('click', function(e) {
                    if (!mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            }
            
            // Manejar cambios de tamaño de pantalla
            window.addEventListener('resize', function() {
                const tab3 = document.getElementById('tab3');
                if (window.innerWidth < 768) {
                    // En móvil, ocultar Imprimibles
                    tab3.classList.add('hidden');
                    tab3.classList.remove('flex');
                    // Si estaba activa la pestaña 3, cambiar a la 0
                    if (tab3.classList.contains('active')) {
                        switchTab(0, 'Calculadora');
                    }
                } else {
                    // En desktop, mostrar Imprimibles
                    tab3.classList.remove('hidden');
                    tab3.classList.add('flex');
                }
            });
        });

        // --- DOM Element References ---
        const netAmountInput = document.getElementById('netAmount');
        const annualRateInput = document.getElementById('annualRate');
        const termMonthsInput = document.getElementById('termMonths');
        const patrimonialPercentageInput = document.getElementById('patrimonialPercentage');
        const solcaPercentageInput = document.getElementById('solcaPercentage');
        const autoseguroPercentageInput = document.getElementById('autoseguroPercentage');
        const generateBtn = document.getElementById('generateBtn');
        const resultsSection = document.getElementById('resultsSection');
        const amortizationSection = document.getElementById('amortizationSection');

        // Summary elements
        const summaryNetAmount = document.getElementById('summaryNetAmount');
        const summaryPatrimonialAmount = document.getElementById('summaryPatrimonialAmount');
        const summaryTotalCredit = document.getElementById('summaryTotalCredit');
        const summaryNetDisbursement = document.getElementById('summaryNetDisbursement');
        const summaryBasePayment = document.getElementById('summaryBasePayment');
        const summarySolcaAmount = document.getElementById('summarySolcaAmount');
        const summaryAutoseguroAmount = document.getElementById('summaryAutoseguroAmount');
        const summaryMonthlyPayment = document.getElementById('summaryMonthlyPayment');
        const summaryTotalToPay = document.getElementById('summaryTotalToPay');
        const financingTypeDisplay = document.getElementById('financingTypeDisplay');
        const monthlyRateDisplay = document.getElementById('monthlyRateDisplay');
        const totalSolcaDisplay = document.getElementById('totalSolcaDisplay');
        const totalAutoseguroDisplay = document.getElementById('totalAutoseguroDisplay');
        const totalInterestDisplay = document.getElementById('totalInterestDisplay');
        const termDisplay = document.getElementById('termDisplay');
        const amortizationTableBody = document.getElementById('amortizationTableBody');

        // --- Utility Functions ---
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function formatPercentage(rate) {
            return (rate * 100).toFixed(2) + '%';
        }

        // --- Main Calculation Function ---
        function calculateLoan() {
            // Get input values
            const netAmount = parseFloat(netAmountInput.value) || 0;
            const annualRate = parseFloat(annualRateInput.value) || 0;
            const termMonths = parseInt(termMonthsInput.value) || 0;
            const patrimonialPercentage = parseFloat(patrimonialPercentageInput.value) || 0;
            const solcaPercentage = parseFloat(solcaPercentageInput.value) || 0;
            const autoseguroPercentage = parseFloat(autoseguroPercentageInput.value) || 0;
            
            // Get financing type
            const financingType = document.querySelector('input[name="financingType"]:checked').value;

            // Validate inputs
            if (netAmount <= 0 || annualRate <= 0 || termMonths <= 0) {
                alert('Por favor, ingrese valores válidos para todos los campos.');
                return;
            }

            if (patrimonialPercentage < 0 || patrimonialPercentage >= 100) {
                alert('El porcentaje del aporte patrimonial debe estar entre 0 y 99.99%');
                return;
            }

            // Calculate monthly interest rate
            const monthlyRate = annualRate / 100 / 12;

            let totalCredit, netDisbursement, patrimonialAmount;

            if (financingType === 'finance') {
                // Option 2: Finance the patrimonial contribution
                // Total credit = Net Amount / (1 - Patrimonial Percentage)
                totalCredit = netAmount / (1 - patrimonialPercentage / 100);
                patrimonialAmount = totalCredit * (patrimonialPercentage / 100);
                netDisbursement = netAmount; // Client receives exactly what they asked for
            } else {
                // Option 1: Discount from credit
                totalCredit = netAmount;
                patrimonialAmount = totalCredit * (patrimonialPercentage / 100);
                netDisbursement = totalCredit - patrimonialAmount;
            }

            // Calculate base monthly payment using the standard loan formula
            // PMT = P * [r(1+r)^n] / [(1+r)^n - 1]
            const baseMonthlyPayment = totalCredit * (monthlyRate * Math.pow(1 + monthlyRate, termMonths)) / 
                                      (Math.pow(1 + monthlyRate, termMonths) - 1);

            // Calculate SOLCA and Autoseguro amounts (based on credit amount)
            const monthlySolca = totalCredit * (solcaPercentage / 100) / termMonths;
            const monthlyAutoseguro = totalCredit * (autoseguroPercentage / 100) / termMonths;

            // Total monthly payment including SOLCA and Autoseguro
            const totalMonthlyPayment = baseMonthlyPayment + monthlySolca + monthlyAutoseguro;

            const baseTotalToPay = baseMonthlyPayment * termMonths;
            const totalSolca = monthlySolca * termMonths;
            const totalAutoseguro = monthlyAutoseguro * termMonths;
            const grandTotalToPay = totalMonthlyPayment * termMonths;
            const totalInterest = baseTotalToPay - totalCredit;

            // Update summary display
            summaryNetAmount.textContent = formatCurrency(netAmount);
            summaryPatrimonialAmount.textContent = formatCurrency(patrimonialAmount);
            summaryTotalCredit.textContent = formatCurrency(totalCredit);
            summaryNetDisbursement.textContent = formatCurrency(netDisbursement);
            summaryBasePayment.textContent = formatCurrency(baseMonthlyPayment);
            summarySolcaAmount.textContent = formatCurrency(monthlySolca);
            summaryAutoseguroAmount.textContent = formatCurrency(monthlyAutoseguro);
            summaryMonthlyPayment.textContent = formatCurrency(totalMonthlyPayment);
            summaryTotalToPay.textContent = formatCurrency(grandTotalToPay);

            // Update additional info
            financingTypeDisplay.textContent = financingType === 'finance' ? 
                'Financiamiento del aporte' : 'Descuento del crédito';
            monthlyRateDisplay.textContent = formatPercentage(monthlyRate);
            totalSolcaDisplay.textContent = formatCurrency(totalSolca);
            totalAutoseguroDisplay.textContent = formatCurrency(totalAutoseguro);
            totalInterestDisplay.textContent = formatCurrency(totalInterest);
            termDisplay.textContent = `${termMonths} meses`;

            // Generate amortization table
            generateAmortizationTable(totalCredit, monthlyRate, termMonths, baseMonthlyPayment, monthlySolca, monthlyAutoseguro);

            // Show results sections
            resultsSection.style.display = 'grid';
            amortizationSection.style.display = 'block';

            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // --- Amortization Table Generation ---
        function generateAmortizationTable(principal, monthlyRate, termMonths, baseMonthlyPayment, monthlySolca, monthlyAutoseguro) {
            let balance = principal;
            let tableHTML = '';

            for (let month = 1; month <= termMonths; month++) {
                const interestPayment = balance * monthlyRate;
                const principalPayment = baseMonthlyPayment - interestPayment;
                const newBalance = balance - principalPayment;

                // Handle final payment rounding
                const finalPrincipalPayment = month === termMonths ? balance : principalPayment;
                const finalBalance = month === termMonths ? 0 : newBalance;
                const finalBasePayment = month === termMonths ? 
                    interestPayment + finalPrincipalPayment : baseMonthlyPayment;

                // Total payment including SOLCA and Autoseguro
                const totalPayment = finalBasePayment + monthlySolca + monthlyAutoseguro;

                tableHTML += `
                    <tr class="${month % 2 === 0 ? 'bg-gray-50' : 'bg-white'}">
                        <td class="px-2 py-2 text-sm text-gray-900">${month}</td>
                        <td class="px-2 py-2 text-sm text-gray-900">${formatCurrency(balance)}</td>
                        <td class="px-2 py-2 text-sm text-gray-700">${formatCurrency(finalBasePayment)}</td>
                        <td class="px-2 py-2 text-sm text-red-600">${formatCurrency(interestPayment)}</td>
                        <td class="px-2 py-2 text-sm text-green-600">${formatCurrency(finalPrincipalPayment)}</td>
                        <td class="px-2 py-2 text-sm text-purple-600">${formatCurrency(monthlySolca)}</td>
                        <td class="px-2 py-2 text-sm text-indigo-600">${formatCurrency(monthlyAutoseguro)}</td>
                        <td class="px-2 py-2 text-sm font-medium text-brand-orange">${formatCurrency(totalPayment)}</td>
                        <td class="px-2 py-2 text-sm text-gray-900">${formatCurrency(finalBalance)}</td>
                    </tr>
                `;

                balance = finalBalance;
            }

            amortizationTableBody.innerHTML = tableHTML;
        }

        // --- Event Listeners ---
        generateBtn.addEventListener('click', calculateLoan);

        // Allow pressing Enter to calculate
        [netAmountInput, annualRateInput, termMonthsInput, patrimonialPercentageInput, solcaPercentageInput, autoseguroPercentageInput].forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    calculateLoan();
                }
            });
        });

        // Radio button change handler
        document.querySelectorAll('input[name="financingType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (resultsSection.style.display !== 'none') {
                    calculateLoan(); // Recalculate if results are already showing
                }
            });
        });

        // --- Custom Alert Modal ---
        class CustomAlert {
            constructor() {
                this.modal = document.getElementById('customAlertModal');
                this.alertIcon = document.getElementById('alertIcon');
                this.alertTitle = document.getElementById('alertTitle');
                this.alertMessage = document.getElementById('alertMessage');
                this.confirmBtn = document.getElementById('alertConfirmBtn');
                this.cancelBtn = document.getElementById('alertCancelBtn');
                
                this.init();
            }

            init() {
                // Close modal when clicking outside or pressing Escape
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !this.modal.classList.contains('hidden')) {
                        this.hide();
                    }
                });

                this.cancelBtn.addEventListener('click', () => {
                    this.hide();
                });
            }

            show(options = {}) {
                const {
                    title = 'Confirmar Acción',
                    message = '¿Estás seguro que deseas continuar?',
                    confirmText = 'Confirmar',
                    cancelText = 'Cancelar',
                    icon = 'fas fa-exclamation-triangle text-yellow-500',
                    onConfirm = null
                } = options;

                this.alertTitle.textContent = title;
                this.alertMessage.textContent = message;
                this.confirmBtn.textContent = confirmText;
                this.cancelBtn.textContent = cancelText;
                this.alertIcon.className = `${icon} text-2xl`;

                // Remove any existing event listeners
                this.confirmBtn.replaceWith(this.confirmBtn.cloneNode(true));
                this.confirmBtn = document.getElementById('alertConfirmBtn');

                // Add new event listener
                this.confirmBtn.addEventListener('click', () => {
                    this.hide();
                    if (onConfirm && typeof onConfirm === 'function') {
                        onConfirm();
                    }
                });

                this.modal.classList.remove('hidden');
                this.confirmBtn.focus();
            }

            hide() {
                this.modal.classList.add('hidden');
            }
        }

        // --- Checklist Management ---
        class DocumentChecklistManager {
            constructor() {
                this.storageKey = 'documentChecklist';
                this.timestampKey = 'documentChecklistTimestamp';
                this.resetPeriod = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds
                this.init();
            }

            init() {
                this.checkExpiration();
                this.loadChecklistState();
                this.attachEventListeners();
                this.updateCounters();
                this.updateLastResetDisplay();
            }

            checkExpiration() {
                const timestamp = localStorage.getItem(this.timestampKey);
                if (timestamp) {
                    const lastReset = new Date(parseInt(timestamp));
                    const now = new Date();
                    const timeDiff = now.getTime() - lastReset.getTime();
                    
                    if (timeDiff > this.resetPeriod) {
                        this.resetChecklist();
                        return;
                    }
                }
                
                // If no timestamp exists, create one
                if (!timestamp) {
                    localStorage.setItem(this.timestampKey, Date.now().toString());
                }
            }

            loadChecklistState() {
                const savedState = localStorage.getItem(this.storageKey);
                if (savedState) {
                    const checkedItems = JSON.parse(savedState);
                    checkedItems.forEach(docId => {
                        const checkbox = document.getElementById(`doc${docId}`);
                        if (checkbox) {
                            checkbox.checked = true;
                            this.updateRowStyle(checkbox, true);
                        }
                    });
                }
            }

            saveChecklistState() {
                const checkboxes = document.querySelectorAll('.document-checkbox');
                const checkedItems = [];
                
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const docId = checkbox.getAttribute('data-doc');
                        checkedItems.push(docId);
                    }
                });
                
                localStorage.setItem(this.storageKey, JSON.stringify(checkedItems));
            }

            resetChecklist() {
                localStorage.removeItem(this.storageKey);
                localStorage.setItem(this.timestampKey, Date.now().toString());
                
                const checkboxes = document.querySelectorAll('.document-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    this.updateRowStyle(checkbox, false);
                });
                
                this.updateCounters();
                this.updateLastResetDisplay();
                this.showResetNotification();
            }

            updateRowStyle(checkbox, isChecked) {
                const row = checkbox.closest('.p-4');
                const label = row.querySelector('label');
                
                if (isChecked) {
                    row.classList.add('bg-green-50');
                    label.classList.add('line-through', 'opacity-75');
                } else {
                    row.classList.remove('bg-green-50');
                    label.classList.remove('line-through', 'opacity-75');
                }
            }

            updateCounters() {
                const checkboxes = document.querySelectorAll('.document-checkbox');
                const totalCount = checkboxes.length;
                const completedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
                
                document.getElementById('completedCount').textContent = completedCount;
                document.getElementById('totalCount').textContent = totalCount;
            }

            updateLastResetDisplay() {
                const timestamp = localStorage.getItem(this.timestampKey);
                const statusElement = document.getElementById('checklistStatus');
                
                if (timestamp) {
                    const lastReset = new Date(parseInt(timestamp));
                    const now = new Date();
                    const daysAgo = Math.floor((now.getTime() - lastReset.getTime()) / (24 * 60 * 60 * 1000));
                    const daysRemaining = Math.max(0, 7 - daysAgo);
                    
                    if (daysRemaining > 0) {
                        statusElement.innerHTML = `
                            <i class="fas fa-clock mr-2"></i>
                            Checklist se reinicia en ${daysRemaining} día${daysRemaining !== 1 ? 's' : ''}
                        `;
                    } else {
                        statusElement.innerHTML = `
                            <i class="fas fa-exclamation-triangle mr-2 text-orange-500"></i>
                            <span class="text-orange-600">Checklist listo para reiniciar</span>
                        `;
                    }
                } else {
                    statusElement.innerHTML = `
                        <i class="fas fa-clock mr-2"></i>
                        Checklist se reinicia automáticamente cada 7 días
                    `;
                }
            }

            showResetNotification() {
                // Create a temporary notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span>Checklist reiniciado correctamente</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                // Animate out and remove
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            attachEventListeners() {
                // Checkbox change listeners
                const checkboxes = document.querySelectorAll('.document-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        this.updateRowStyle(e.target, e.target.checked);
                        this.saveChecklistState();
                        this.updateCounters();
                    });
                });

                // Reset button listener
                const resetButton = document.getElementById('resetChecklistBtn');
                if (resetButton) {
                    resetButton.addEventListener('click', () => {
                        if (!window.customAlert) {
                            window.customAlert = new CustomAlert();
                        }
                        
                        window.customAlert.show({
                            title: 'Reiniciar Checklist',
                            message: '¿Estás seguro que deseas reiniciar el checklist? Se perderá todo el progreso actual.',
                            confirmText: 'Sí, Reiniciar',
                            cancelText: 'Cancelar',
                            icon: 'fas fa-refresh text-orange-500',
                            onConfirm: () => {
                                this.resetChecklist();
                            }
                        });
                    });
                }
            }
        }

        // Initialize checklist manager when on the documentation tab
        let checklistManager = null;
        
        // Override the switchTab function to initialize checklist on documentation tab
        const originalSwitchTab = switchTab;
        switchTab = function(tabIndex) {
            originalSwitchTab(tabIndex);
            
            // Initialize checklist manager when switching to documentation tab (index 2)
            if (tabIndex === 2 && !checklistManager) {
                setTimeout(() => {
                    checklistManager = new DocumentChecklistManager();
                }, 100);
            }
        };

        // --- Initialize MathJax when loaded ---
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    
    <!-- Main application script -->
    <script src="main.js"></script>
    
    <!-- Initialize authentication on page load -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Loading screen is already visible via inline style
            
            // Check authentication status
            if (window.TupakAuth && window.TupakAuth.checkAuth) {
                await window.TupakAuth.checkAuth();
            } else {
                // Fallback: check auth after main.js loads
                setTimeout(async () => {
                    if (window.TupakAuth && window.TupakAuth.checkAuth) {
                        await window.TupakAuth.checkAuth();
                    }
                }, 100);
            }
        });
    </script>

</body>
</html>




